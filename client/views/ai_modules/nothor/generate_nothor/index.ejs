<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI SÄ±fÄ±rdan Not OluÅŸturur - Learnity</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles/ai_modules/nothor/generate_nothor/style.css">
    <script src="https://kit.fontawesome.com/c4254e24a8.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="generate-page">

    <!-- Header Navigation -->
    <div class="header-container">
        <header class="navbar">
            <div class="logo">
                <a href="/">
                    <img src="/img/logo.png" alt="Learnity Logo">
                    <span class="logo-text">Learnity</span>
                </a>
            </div>
            
            <nav class="breadcrumb">
                <a href="/dashboard">Dashboard</a>
                <span class="separator">></span>
                <a href="/ai_modules/nothor">AI Not AsistanÄ±</a>
                <span class="separator">></span>
                <span class="current">AI SÄ±fÄ±rdan Not OluÅŸturur</span>
            </nav>
        </header>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>AI SÄ±fÄ±rdan Not OluÅŸturur</h1>
            <p>Ã–ÄŸrenmek istediÄŸiniz konuyu belirtin, AI sizin iÃ§in detaylÄ± ve kapsamlÄ± notlar oluÅŸtursun.</p>
        </div>

        <!-- Content Wrapper -->
        <div class="content-wrapper">
            <!-- Input Section - AI SÄ±fÄ±rdan Not OluÅŸturur -->
            <div class="input-section">
                <div class="input-card">
                    <h3 class="input-title">
                        <i class="fas fa-magic"></i>
                        Konu Belirleyin
                    </h3>
                    
                    <div class="topic-input-group">
                        <label for="topic-input">Hangi konu hakkÄ±nda not oluÅŸturmak istiyorsunuz?</label>
                        <textarea 
                            id="topic-input" 
                            placeholder="Ã–rnek: Python programlama dili temel kavramlarÄ±, OsmanlÄ± Ä°mparatorluÄŸu'nun kuruluÅŸ dÃ¶nemi, Matematik tÃ¼rev konusu..."
                            rows="4"
                        ></textarea>
                    </div>

                    <div class="options-group">
                        <h4>Not Detay Seviyesi</h4>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="detail-level" value="basic" checked>
                                <span class="radio-custom"></span>
                                <div class="radio-content">
                                    <strong>Temel</strong>
                                    <span>Ana baÅŸlÄ±klar ve Ã¶nemli noktalar</span>
                                </div>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="detail-level" value="detailed">
                                <span class="radio-custom"></span>
                                <div class="radio-content">
                                    <strong>DetaylÄ±</strong>
                                    <span>AÃ§Ä±klamalar, Ã¶rnekler ve alt baÅŸlÄ±klar</span>
                                </div>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="detail-level" value="comprehensive">
                                <span class="radio-custom"></span>
                                <div class="radio-content">
                                    <strong>KapsamlÄ±</strong>
                                    <span>Derinlemesine analiz, Ã§oklu Ã¶rnekler</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="options-group">
                        <h4>Not FormatÄ±</h4>
                        <div class="checkbox-group">
                            <label class="checkbox-option">
                                <input type="checkbox" id="include-examples" checked>
                                <span class="checkbox-custom"></span>
                                Ã–rnekler ekle
                            </label>
                            <label class="checkbox-option">
                                <input type="checkbox" id="include-summary">
                                <span class="checkbox-custom"></span>
                                Ã–zet bÃ¶lÃ¼mÃ¼ ekle
                            </label>
                            <label class="checkbox-option">
                                <input type="checkbox" id="include-questions">
                                <span class="checkbox-custom"></span>
                                Kontrol sorularÄ± ekle
                            </label>
                        </div>
                    </div>

                    <button class="generate-btn" id="generate-notes-btn">
                        <i class="fas fa-magic"></i>
                        <span class="btn-text">Not OluÅŸtur</span>
                        <div class="loading-spinner" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Saved Notes Section - Not Depolama AlanÄ± -->
            <div class="saved-notes-section">
                <div class="saved-notes-card">
                    <div class="saved-notes-header">
                        <h3 class="saved-notes-title">
                            <i class="fas fa-bookmark"></i>
                            KayÄ±tlÄ± NotlarÄ±m
                        </h3>
                        <div class="notes-actions">
                            <button class="action-btn search-btn" id="search-notes-btn">
                                <i class="fas fa-search"></i>
                            </button>
                            <button class="action-btn filter-btn" id="filter-notes-btn">
                                <i class="fas fa-filter"></i>
                            </button>
                        </div>
                    </div>

                    <div class="search-bar" id="search-bar" style="display: none;">
                        <input type="text" id="search-input" placeholder="Notlarda ara...">
                        <button class="search-close-btn" id="search-close-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="notes-list" id="notes-list">
                        <div class="empty-state" id="empty-state">
                            <i class="fas fa-sticky-note"></i>
                            <h4>HenÃ¼z kayÄ±tlÄ± notunuz yok</h4>
                            <p>AI ile oluÅŸturduÄŸunuz notlar burada gÃ¶rÃ¼necek</p>
                        </div>
                    </div>

                    <div class="notes-pagination" id="notes-pagination" style="display: none;">
                        <button class="pagination-btn" id="prev-page-btn" disabled>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span class="page-info" id="page-info">1 / 1</span>
                        <button class="pagination-btn" id="next-page-btn" disabled>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Output Section - OluÅŸturulan Not Ã–nizleme -->
        <div class="output-section" id="output-section" style="display: none;">
            <div class="output-card">
                <div class="output-header">
                    <h3 class="output-title">
                        <i class="fas fa-file-alt"></i>
                        OluÅŸturulan Not
                    </h3>
                    <div class="output-actions">
                        <button class="action-btn save-note-btn" id="save-note-btn">
                            <i class="fas fa-bookmark"></i>
                            Kaydet
                        </button>
                        <button class="action-btn copy-btn" id="copy-btn">
                            <i class="fas fa-copy"></i>
                            Kopyala
                        </button>
                        <button class="action-btn download-btn" id="download-btn">
                            <i class="fas fa-download"></i>
                            Ä°ndir
                        </button>
                    </div>
                </div>
                
                <div class="output-content" id="output-content">
                    <!-- Gemini AI tarafÄ±ndan oluÅŸturulan not buraya gelecek -->
                </div>
            </div>
        </div>

        <!-- Note Edit Modal -->
        <div class="modal-overlay" id="note-edit-modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>
                        <i class="fas fa-edit"></i>
                        Notu DÃ¼zenle
                    </h3>
                    <button class="modal-close-btn" onclick="closeNoteEditModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="modal-body">
                    <div class="form-group">
                        <label for="edit-note-title">Not BaÅŸlÄ±ÄŸÄ±</label>
                        <input type="text" id="edit-note-title" class="form-input" placeholder="Not baÅŸlÄ±ÄŸÄ±nÄ± girin...">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-note-subject">Ders Kategorisi</label>
                        <select id="edit-note-subject" class="form-select">
                            <option value="auto">ğŸ¤– AI Otomatik AlgÄ±lasÄ±n</option>
                            <option value="matematik">ğŸ“ Matematik</option>
                            <option value="geometri">ğŸ“ Geometri</option>
                            <option value="fizik">âš¡ Fizik</option>
                            <option value="kimya">ğŸ§ª Kimya</option>
                            <option value="biyoloji">ğŸ§¬ Biyoloji</option>
                            <option value="turkce">ğŸ“ TÃ¼rkÃ§e</option>
                            <option value="edebiyat">ğŸ“š TÃ¼rk Dili ve EdebiyatÄ±</option>
                            <option value="tarih">ğŸ›ï¸ Tarih</option>
                            <option value="cografya">ğŸŒ CoÄŸrafya</option>
                            <option value="ingilizce">ğŸ‡¬ğŸ‡§ Ä°ngilizce</option>
                            <option value="din">âœï¸ Din KÃ¼ltÃ¼rÃ¼ ve Ahlak Bilgisi</option>
                            <option value="felsefe">ğŸ’¡ Felsefe</option>
                            <option value="diger">ğŸ“‹ DiÄŸer</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-note-content">Not Ä°Ã§eriÄŸi</label>
                        <textarea id="edit-note-content" class="form-textarea" rows="10" placeholder="Not iÃ§eriÄŸini dÃ¼zenleyin..."></textarea>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeNoteEditModal()">
                        <i class="fas fa-times"></i>
                        Ä°ptal
                    </button>
                    <button class="btn btn-danger" onclick="deleteCurrentNote()">
                        <i class="fas fa-trash"></i>
                        Sil
                    </button>
                    <button class="btn btn-primary" onclick="saveEditedNote()">
                        <i class="fas fa-save"></i>
                        Kaydet
                    </button>
                </div>
            </div>
        </div>

        <!-- Tips Section -->
        <div class="tips-section">
            <h3><i class="fas fa-lightbulb"></i> Ä°puÃ§larÄ±</h3>
            <div class="tips-grid">
                <div class="tip-card">
                    <h4>Spesifik Olun</h4>
                    <p>Konuyu mÃ¼mkÃ¼n olduÄŸunca spesifik belirtin. "Matematik" yerine "TÃ¼rev alma kurallarÄ±" deyin.</p>
                </div>
                <div class="tip-card">
                    <h4>Seviye Belirtin</h4>
                    <p>Hangi seviyede bilgi istediÄŸinizi belirtin: baÅŸlangÄ±Ã§, orta, ileri seviye.</p>
                </div>
                <div class="tip-card">
                    <h4>Alt KonularÄ± Belirtin</h4>
                    <p>Hangi alt konularÄ±n dahil edilmesini istediÄŸinizi belirtebilirsiniz.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Note Management Functions
        let savedNotes = JSON.parse(localStorage.getItem('learnity_saved_notes') || '[]');
        let currentPage = 1;
        const notesPerPage = 5;
        let filteredNotes = savedNotes;

        // Subject Classification and Management
        let currentEditingNoteId = null;
        
        const subjectKeywords = {
            matematik: ['matematik', 'sayÄ±', 'iÅŸlem', 'denklem', 'geometri', 'algebra', 'hesap', 'Ã§arpÄ±m', 'toplam', 'integral', 'tÃ¼rev', 'fonksiyon'],
            geometri: ['geometri', 'Ã¼Ã§gen', 'kare', 'daire', 'alan', 'Ã§evre', 'aÃ§Ä±', 'kenar', 'ÅŸekil', 'prizma', 'kÃ¼p'],
            fizik: ['fizik', 'kuvvet', 'hareket', 'enerji', 'hÄ±z', 'ivme', 'elektrik', 'manyetik', 'Ä±ÅŸÄ±k', 'ses', 'basÄ±nÃ§', 'sÄ±caklÄ±k'],
            kimya: ['kimya', 'element', 'atom', 'molekÃ¼l', 'reaksiyon', 'asit', 'baz', 'periyodik', 'karbon', 'oksijen', 'hidrojen'],
            biyoloji: ['biyoloji', 'hÃ¼cre', 'organ', 'sistem', 'dna', 'gen', 'protein', 'mitoz', 'fotosentez', 'solunum', 'sindirim'],
            turkce: ['tÃ¼rkÃ§e', 'dil', 'gramer', 'cÃ¼mle', 'kelime', 'yazÄ±m', 'imla', 'noktalama', 'fiil', 'isim', 'sÄ±fat'],
            edebiyat: ['edebiyat', 'ÅŸiir', 'roman', 'hikaye', 'yazar', 'ÅŸair', 'eser', 'nazÄ±m', 'nesir', 'divan', 'halk'],
            tarih: ['tarih', 'osmanlÄ±', 'selÃ§uklu', 'cumhuriyet', 'savaÅŸ', 'antlaÅŸma', 'devrim', 'reform', 'padiÅŸah', 'sultan'],
            cografya: ['coÄŸrafya', 'harita', 'iklim', 'nÃ¼fus', 'ÅŸehir', 'Ã¼lke', 'kÄ±ta', 'deniz', 'daÄŸ', 'nehir', 'ekonomi'],
            ingilizce: ['english', 'grammar', 'vocabulary', 'tense', 'verb', 'noun', 'adjective', 'sentence', 'present', 'past'],
            din: ['din','din kÃ¼ltÃ¼rÃ¼','din kÃ¼ltÃ¼rÃ¼ ve ahlak bilgisi','islam', 'kuran', 'hadis', 'peygamber', 'allah', 'namaz', 'oruÃ§', 'hac', 'zekat', 'ahlak', 'ibadet', 'dua'],
            felsefe: ['felsefe','felsefe ve etik','felsefe ve ahlak','dÃ¼ÅŸÃ¼nce', 'mantÄ±k', 'etik', 'ahlak', 'varlÄ±k', 'bilgi', 'hakikat', 'Ã¶zgÃ¼rlÃ¼k', 'adalet', 'gÃ¼zellik', 'platon', 'aristoteles']
        };

        function detectSubject(content) {
            const text = content.toLowerCase();
            let maxScore = 0;
            let detectedSubject = 'diger';

            for (const [subject, keywords] of Object.entries(subjectKeywords)) {
                let score = 0;
                keywords.forEach(keyword => {
                    const regex = new RegExp(keyword, 'gi');
                    const matches = text.match(regex);
                    if (matches) {
                        score += matches.length;
                    }
                });
                
                if (score > maxScore) {
                    maxScore = score;
                    detectedSubject = subject;
                }
            }

            return detectedSubject;
        }

        function getSubjectInfo(subject) {
            const subjectMap = {
                matematik: { name: 'Matematik', icon: 'ğŸ“', color: '#ff6b6b' },
                geometri: { name: 'Geometri', icon: 'ğŸ“', color: '#4ecdc4' },
                fizik: { name: 'Fizik', icon: 'âš¡', color: '#45b7d1' },
                kimya: { name: 'Kimya', icon: 'ğŸ§ª', color: '#f9ca24' },
                biyoloji: { name: 'Biyoloji', icon: 'ğŸ§¬', color: '#6c5ce7' },
                turkce: { name: 'TÃ¼rkÃ§e', icon: 'ğŸ“', color: '#a29bfe' },
                edebiyat: { name: 'TÃ¼rk Dili ve EdebiyatÄ±', icon: 'ğŸ“š', color: '#fd79a8' },
                tarih: { name: 'Tarih', icon: 'ğŸ›ï¸', color: '#e17055' },
                cografya: { name: 'CoÄŸrafya', icon: 'ğŸŒ', color: '#00b894' },
                ingilizce: { name: 'Ä°ngilizce', icon: 'ğŸ‡¬ğŸ‡§', color: '#0984e3' },
                din: { name: 'Din KÃ¼ltÃ¼rÃ¼ ve Ahlak Bilgisi', icon: 'âœï¸', color: '#8e44ad' },
                felsefe: { name: 'Felsefe', icon: 'ğŸ’¡', color: '#2ecc71' },
                diger: { name: 'DiÄŸer', icon: 'ğŸ“‹', color: '#636e72' }
            };
            return subjectMap[subject] || subjectMap.diger;
        }

        function displaySavedNotes() {
            const notesList = document.getElementById('notes-list');
            const pagination = document.getElementById('notes-pagination');
            
            if (filteredNotes.length === 0) {
                notesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-sticky-note"></i>
                        <h4>HenÃ¼z kayÄ±tlÄ± notunuz yok</h4>
                        <p>AI ile oluÅŸturduÄŸunuz notlar burada gÃ¶rÃ¼necek</p>
                    </div>
                `;
                pagination.style.display = 'none';
                return;
            }

            const startIndex = (currentPage - 1) * notesPerPage;
            const endIndex = startIndex + notesPerPage;
            const currentNotes = filteredNotes.slice(startIndex, endIndex);
            
            notesList.innerHTML = currentNotes.map(note => {
                const subjectInfo = getSubjectInfo(note.subject || 'diger');
                return `
                    <div class="note-item subject-${note.subject || 'diger'}" data-note-id="${note.id}" onclick="openNoteEditModal('${note.id}')">
                        <div class="note-content">
                            <div class="note-header-with-subject">
                                <span class="subject-icon ${note.subject || 'diger'}">${subjectInfo.icon}</span>
                                <h4 class="note-title">${note.title}</h4>
                            </div>
                            <p class="note-preview">${note.preview}</p>
                            <div class="note-meta">
                                <span class="note-date">
                                    <i class="fas fa-calendar"></i>
                                    ${new Date(note.createdAt).toLocaleDateString('tr-TR')}
                                </span>
                                <span class="note-subject">
                                    <i class="fas fa-tag"></i>
                                    ${subjectInfo.name}
                                </span>
                            </div>
                        </div>
                        <div class="note-actions" onclick="event.stopPropagation()">
                            <button class="note-action-btn view-btn" onclick="viewNote('${note.id}')" title="Notu GÃ¶rÃ¼ntÃ¼le">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="note-action-btn edit-btn" onclick="openNoteEditModal('${note.id}')" title="Notu DÃ¼zenle">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="note-action-btn delete-btn" onclick="deleteNote('${note.id}')" title="Notu Sil">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // Update pagination
            const totalPages = Math.ceil(filteredNotes.length / notesPerPage);
            if (totalPages > 1) {
                pagination.style.display = 'flex';
                document.getElementById('page-info').textContent = `${currentPage} / ${totalPages}`;
                document.getElementById('prev-page-btn').disabled = currentPage === 1;
                document.getElementById('next-page-btn').disabled = currentPage === totalPages;
            } else {
                pagination.style.display = 'none';
            }
        }

        function openNoteEditModal(noteId) {
            const note = savedNotes.find(n => n.id === noteId);
            if (note) {
                currentEditingNoteId = noteId;
                document.getElementById('edit-note-title').value = note.title;
                document.getElementById('edit-note-subject').value = note.subject || 'auto';
                document.getElementById('edit-note-content').value = note.content.replace(/<[^>]*>/g, '');
                document.getElementById('note-edit-modal').style.display = 'block';
            }
        }

        function closeNoteEditModal() {
            document.getElementById('note-edit-modal').style.display = 'none';
            currentEditingNoteId = null;
        }

        function saveEditedNote() {
            if (!currentEditingNoteId) return;
            
            const noteIndex = savedNotes.findIndex(n => n.id === currentEditingNoteId);
            if (noteIndex !== -1) {
                const title = document.getElementById('edit-note-title').value;
                const selectedSubject = document.getElementById('edit-note-subject').value;
                const content = document.getElementById('edit-note-content').value;
                
                // Auto-detect subject if selected
                const subject = selectedSubject === 'auto' ? detectSubject(content) : selectedSubject;
                
                savedNotes[noteIndex].title = title;
                savedNotes[noteIndex].subject = subject;
                savedNotes[noteIndex].content = content;
                savedNotes[noteIndex].preview = content.substring(0, 100) + '...';
                
                localStorage.setItem('learnity_saved_notes', JSON.stringify(savedNotes));
                filteredNotes = savedNotes;
                displaySavedNotes();
                closeNoteEditModal();
                
                alert('Not baÅŸarÄ±yla gÃ¼ncellendi!');
            }
        }

        function deleteCurrentNote() {
            if (!currentEditingNoteId) return;
            
            if (confirm('Bu notu silmek istediÄŸinizden emin misiniz?')) {
                savedNotes = savedNotes.filter(note => note.id !== currentEditingNoteId);
                localStorage.setItem('learnity_saved_notes', JSON.stringify(savedNotes));
                filteredNotes = savedNotes;
                displaySavedNotes();
                closeNoteEditModal();
                
                alert('Not baÅŸarÄ±yla silindi!');
            }
        }

        function deleteNote(noteId) {
            if (confirm('Bu notu silmek istediÄŸinizden emin misiniz?')) {
                savedNotes = savedNotes.filter(note => note.id !== noteId);
                localStorage.setItem('learnity_saved_notes', JSON.stringify(savedNotes));
                filteredNotes = savedNotes;
                displaySavedNotes();
                
                alert('Not baÅŸarÄ±yla silindi!');
            }
        }

        function viewNote(noteId) {
            const note = savedNotes.find(n => n.id === noteId);
            if (note) {
                // Display note in output section
                document.getElementById('output-content').innerHTML = note.content;
                document.getElementById('output-section').style.display = 'block';
                
                // Scroll to output section
                document.getElementById('output-section').scrollIntoView({ 
                    behavior: 'smooth' 
                });
            }
        }

        function searchNotes() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            filteredNotes = savedNotes.filter(note => 
                note.title.toLowerCase().includes(searchTerm) ||
                note.topic.toLowerCase().includes(searchTerm) ||
                note.preview.toLowerCase().includes(searchTerm)
            );
            currentPage = 1;
            displaySavedNotes();
        }

        // Search functionality
        document.getElementById('search-notes-btn').addEventListener('click', function() {
            const searchBar = document.getElementById('search-bar');
            const isVisible = searchBar.style.display !== 'none';
            searchBar.style.display = isVisible ? 'none' : 'block';
            if (!isVisible) {
                document.getElementById('search-input').focus();
            }
        });

        document.getElementById('search-close-btn').addEventListener('click', function() {
            document.getElementById('search-bar').style.display = 'none';
            document.getElementById('search-input').value = '';
            filteredNotes = savedNotes;
            displaySavedNotes();
        });

        document.getElementById('search-input').addEventListener('input', searchNotes);

        // Filter functionality
        document.getElementById('filter-notes-btn').addEventListener('click', function() {
            // Simple filter toggle between all notes and generated notes only
            if (filteredNotes.length === savedNotes.length) {
                filteredNotes = savedNotes.filter(note => note.type === 'generated');
                this.style.background = '#667eea';
                this.style.color = 'white';
                this.title = 'TÃ¼m NotlarÄ± GÃ¶ster';
            } else {
                filteredNotes = savedNotes;
                this.style.background = '';
                this.style.color = '';
                this.title = 'Sadece OluÅŸturulan NotlarÄ± GÃ¶ster';
            }
            currentPage = 1;
            displaySavedNotes();
        });

        // Pagination
        document.getElementById('prev-page-btn').addEventListener('click', function() {
            if (currentPage > 1) {
                currentPage--;
                displaySavedNotes();
            }
        });

        document.getElementById('next-page-btn').addEventListener('click', function() {
            const totalPages = Math.ceil(filteredNotes.length / notesPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displaySavedNotes();
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            displaySavedNotes();
        });

        // Generate Notes Button Event Listener
        document.getElementById('generate-notes-btn').addEventListener('click', async function() {
            const topicInput = document.getElementById('topic-input');
            const detailLevel = document.querySelector('input[name="detail-level"]:checked');
            
            if (!topicInput.value.trim()) {
                alert('LÃ¼tfen bir konu girin.');
                return;
            }
            
            if (!detailLevel) {
                alert('LÃ¼tfen detay seviyesi seÃ§in.');
                return;
            }
            
            // Show loading state
            const btn = this;
            const btnText = btn.querySelector('.btn-text');
            const spinner = btn.querySelector('.loading-spinner');
            
            btn.disabled = true;
            btnText.style.display = 'none';
            spinner.style.display = 'inline-block';
            
            try {
                // Real API call to backend
                const response = await axios.post('/ai_modules/nothor/generate_nothor', {
                    subject: topicInput.value.trim(),
                    type: detailLevel.value
                });
                
                if (response.data.success) {
                    const noteData = {
                        topic: topicInput.value.trim(),
                        detailLevel: detailLevel.value,
                        content: response.data.data.content,
                        createdAt: response.data.data.createdAt,
                        includeExamples: document.getElementById('include-examples').checked,
                        includeSummary: document.getElementById('include-summary').checked,
                        includeQuestions: document.getElementById('include-questions').checked
                    };
                    
                    displayGeneratedNote(noteData);
                    
                    // Clear form
                    topicInput.value = '';
                    document.querySelector('input[name="detail-level"]:checked').checked = false;
                    document.getElementById('include-examples').checked = true;
                    document.getElementById('include-summary').checked = false;
                    document.getElementById('include-questions').checked = false;
                } else {
                    throw new Error(response.data.message || 'Not oluÅŸturulamadÄ±.');
                }
                
            } catch (error) {
                console.error('Note generation error:', error);
                let errorMessage = 'Not oluÅŸturulurken bir hata oluÅŸtu.';
                
                if (error.response) {
                    errorMessage = error.response.data.message || errorMessage;
                } else if (error.message) {
                    errorMessage = error.message;
                }
                
                alert(errorMessage);
            } finally {
                // Reset button state
                btn.disabled = false;
                btnText.style.display = 'inline-block';
                spinner.style.display = 'none';
            }
        });

        // Display Generated Note Function
        function displayGeneratedNote(noteData) {
            // Create formatted note content from API response
            const detailLevels = {
                'basic': 'Temel',
                'detailed': 'DetaylÄ±', 
                'comprehensive': 'KapsamlÄ±'
            };

            const formattedContent = `
                <div class="generated-note">
                    <div class="note-header-info">
                        <h2>${noteData.topic}</h2>
                        <div class="note-meta-info">
                            <span class="detail-level">${detailLevels[noteData.detailLevel]} Seviye</span>
                            <span class="generation-date">${new Date(noteData.createdAt).toLocaleDateString('tr-TR')}</span>
                        </div>
                    </div>
                    
                    <div class="note-content">
                        ${noteData.content}
                    </div>
                    
                    <div class="ai-signature">
                        <p><em>ğŸ¤– Bu not Gemini AI tarafÄ±ndan oluÅŸturulmuÅŸtur.</em></p>
                    </div>
                </div>
            `;

            // Display the note in output section
            document.getElementById('output-content').innerHTML = formattedContent;
            document.getElementById('output-section').style.display = 'block';
            
            // Scroll to output section
            document.getElementById('output-section').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        // Gemini AI Request Processing Function
        async function processGeminiRequest(button, data) {
            // UI Updates
            const btnText = button.querySelector('.btn-text');
            const loadingSpinner = button.querySelector('.loading-spinner');
            
            button.disabled = true;
            btnText.style.display = 'none';
            loadingSpinner.style.display = 'inline-block';

            try {
                // TODO: GerÃ§ek Gemini API Ã§aÄŸrÄ±sÄ± burada yapÄ±lacak
                // Åimdilik mock response kullanÄ±yoruz
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Mock Gemini response (gerÃ§ek API entegrasyonu iÃ§in hazÄ±r)
                const mockResponse = generateMockNote(data);
                
                // Show output
                document.getElementById('output-content').innerHTML = mockResponse;
                document.getElementById('output-section').style.display = 'block';
                
                // Scroll to output
                document.getElementById('output-section').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Gemini API Error:', error);
                alert('Not oluÅŸturulurken bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.');
            } finally {
                // Reset button state
                button.disabled = false;
                btnText.style.display = 'inline';
                loadingSpinner.style.display = 'none';
            }
        }

        function generateMockNote(data) {
            const detailLevels = {
                'basic': 'Temel',
                'detailed': 'DetaylÄ±', 
                'comprehensive': 'KapsamlÄ±'
            };

            return `
                <div class="generated-note">
                    <div class="note-header-info">
                        <h2>${data.topic}</h2>
                        <div class="note-meta-info">
                            <span class="detail-level">${detailLevels[data.detailLevel]} Seviye</span>
                            <span class="generation-date">${new Date().toLocaleDateString('tr-TR')}</span>
                        </div>
                    </div>
                    
                    <div class="note-content">
                        <h3>ğŸ“š GiriÅŸ</h3>
                        <p>Bu not, <strong>${data.topic}</strong> konusu hakkÄ±nda ${detailLevels[data.detailLevel].toLowerCase()} seviyede hazÄ±rlanmÄ±ÅŸtÄ±r.</p>
                        
                        <h3>ğŸ¯ Ana Konular</h3>
                        <ul>
                            <li>Temel kavramlar ve tanÄ±mlar</li>
                            <li>Ã–nemli Ã¶zellikler ve prensipler</li>
                            <li>Pratik uygulamalar</li>
                            ${data.detailLevel !== 'basic' ? '<li>Derinlemesine analiz</li>' : ''}
                        </ul>
                        
                        ${data.includeExamples ? `
                        <h3>ğŸ’¡ Ã–rnekler</h3>
                        <div class="examples-section">
                            <p><strong>Ã–rnek 1:</strong> ${data.topic} ile ilgili pratik bir Ã¶rnek...</p>
                            <p><strong>Ã–rnek 2:</strong> GerÃ§ek hayattan bir uygulama...</p>
                        </div>
                        ` : ''}
                        
                        ${data.includeSummary ? `
                        <h3>ğŸ“ Ã–zet</h3>
                        <div class="summary-section">
                            <p>${data.topic} konusunun temel noktalarÄ± Ã¶zetlendiÄŸinde...</p>
                        </div>
                        ` : ''}
                        
                        ${data.includeQuestions ? `
                        <h3>â“ Kontrol SorularÄ±</h3>
                        <div class="questions-section">
                            <ol>
                                <li>${data.topic} nedir ve neden Ã¶nemlidir?</li>
                                <li>Ana Ã¶zellikler nelerdir?</li>
                                <li>Pratik uygulamalarÄ± nasÄ±l yapÄ±lÄ±r?</li>
                            </ol>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="ai-signature">
                        <p><em>ğŸ¤– Bu not Gemini AI tarafÄ±ndan oluÅŸturulmuÅŸtur.</em></p>
                    </div>
                </div>
            `;
        }

        // Save note button handler
        document.getElementById('save-note-btn').addEventListener('click', function() {
            const outputContent = document.getElementById('output-content').innerHTML;
            
            if (!outputContent || outputContent === '<!-- Gemini AI tarafÄ±ndan oluÅŸturulan not buraya gelecek -->' || outputContent.trim() === '') {
                alert('Kaydedilecek not bulunamadÄ±!');
                return;
            }

            // Get topic from the generated note header or use a default
            const noteHeaderElement = document.querySelector('#output-content .note-header-info h2');
            const topicFromNote = noteHeaderElement ? noteHeaderElement.textContent.trim() : 'OluÅŸturulan Not';
            
            // AI ile ders kategorisini otomatik algÄ±la
            const detectedSubject = detectSubject(topicFromNote + ' ' + outputContent);
            
            const note = {
                id: Date.now().toString(),
                title: topicFromNote.substring(0, 50) + (topicFromNote.length > 50 ? '...' : ''),
                topic: topicFromNote,
                subject: detectedSubject, // AI tarafÄ±ndan algÄ±lanan ders kategorisi
                content: outputContent,
                preview: outputContent.replace(/<[^>]*>/g, '').substring(0, 100) + '...',
                createdAt: new Date().toISOString(),
                type: 'generated' // Generated note type
            };

            savedNotes.unshift(note);
            localStorage.setItem('learnity_saved_notes', JSON.stringify(savedNotes));
            filteredNotes = savedNotes;
            displaySavedNotes();
            
            const subjectInfo = getSubjectInfo(detectedSubject);
            alert(`Not baÅŸarÄ±yla kaydedildi!\nğŸ¯ AlgÄ±lanan Ders: ${subjectInfo.icon} ${subjectInfo.name}`);
        });

        // Copy button handler
        document.getElementById('copy-btn').addEventListener('click', function() {
            const content = document.getElementById('output-content').innerText;
            navigator.clipboard.writeText(content).then(() => {
                const icon = this.querySelector('i');
                const originalClass = icon.className;
                icon.className = 'fas fa-check';
                setTimeout(() => {
                    icon.className = originalClass;
                }, 2000);
            });
        });

        // Download button handler
        document.getElementById('download-btn').addEventListener('click', function() {
            const content = document.getElementById('output-content').innerText;
            const topic = document.getElementById('topic-input').value.trim() || 'not';
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${topic.replace(/[^a-zA-Z0-9]/g, '_')}_not.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Subject Category Management
        let currentSelectedSubject = null;
        let isShowingSubjectNotes = false;

        function displaySubjectCategories() {
            const notesList = document.getElementById('notes-list');
            const subjectCounts = {};
            
            // Count notes by subject
            savedNotes.forEach(note => {
                const subject = note.subject || 'diger';
                subjectCounts[subject] = (subjectCounts[subject] || 0) + 1;
            });

            const subjects = [
                'matematik', 'geometri', 'fizik', 'kimya', 'biyoloji',
                'turkce', 'edebiyat', 'tarih', 'cografya', 'ingilizce', 'din', 'felsefe', 'diger'
            ];

            if (Object.keys(subjectCounts).length === 0) {
                notesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-sticky-note"></i>
                        <h4>HenÃ¼z kayÄ±tlÄ± notunuz yok</h4>
                        <p>AI ile oluÅŸturulan notlar burada gÃ¶rÃ¼necek</p>
                    </div>
                `;
                return;
            }

            notesList.innerHTML = `
                <div class="subject-categories-header">
                    <h3><i class="fas fa-layer-group"></i> Ders Kategorileri</h3>
                    <p>NotlarÄ±nÄ±z ders tÃ¼rÃ¼ne gÃ¶re gruplandÄ±rÄ±lmÄ±ÅŸtÄ±r</p>
                </div>
                <div class="subject-categories-grid">
                    ${subjects.map(subject => {
                        const subjectInfo = getSubjectInfo(subject);
                        const count = subjectCounts[subject] || 0;
                        return `
                            <div class="subject-category-card ${count === 0 ? 'empty' : ''}" 
                                 onclick="showSubjectNotes('${subject}')" 
                                 data-subject="${subject}">
                                <div class="subject-card-icon">${subjectInfo.icon}</div>
                                <div class="subject-card-name">${subjectInfo.name}</div>
                                <div class="subject-card-count">${count} not</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;

            // Hide pagination when showing categories
            document.getElementById('notes-pagination').style.display = 'none';
        }

        function showSubjectNotes(subject) {
            currentSelectedSubject = subject;
            isShowingSubjectNotes = true;
            
            const subjectNotes = savedNotes.filter(note => (note.subject || 'diger') === subject);
            const subjectInfo = getSubjectInfo(subject);
            const notesList = document.getElementById('notes-list');

            if (subjectNotes.length === 0) {
                notesList.innerHTML = `
                    <div class="subject-notes-header">
                        <button class="back-to-categories-btn" onclick="backToCategories()">
                            <i class="fas fa-arrow-left"></i> Kategorilere DÃ¶n
                        </button>
                        <h3>${subjectInfo.icon} ${subjectInfo.name} NotlarÄ±</h3>
                    </div>
                    <div class="empty-state">
                        <i class="fas fa-sticky-note"></i>
                        <h4>Bu derste henÃ¼z notunuz yok</h4>
                        <p>AI ile ${subjectInfo.name.toLowerCase()} notlarÄ± oluÅŸturun</p>
                    </div>
                `;
                return;
            }

            notesList.innerHTML = `
                <div class="subject-notes-header">
                    <button class="back-to-categories-btn" onclick="backToCategories()">
                        <i class="fas fa-arrow-left"></i> Kategorilere DÃ¶n
                    </button>
                    <h3>${subjectInfo.icon} ${subjectInfo.name} NotlarÄ± (${subjectNotes.length})</h3>
                </div>
                <div class="subject-notes-list">
                    ${subjectNotes.map(note => `
                        <div class="subject-note-item" onclick="openNoteEditModal('${note.id}')">
                            <div class="subject-note-content">
                                <h4 class="subject-note-title">${note.title}</h4>
                                <p class="subject-note-preview">${note.preview}</p>
                                <div class="subject-note-date">
                                    <i class="fas fa-calendar"></i>
                                    ${new Date(note.createdAt).toLocaleDateString('tr-TR')}
                                </div>
                            </div>
                            <div class="subject-note-actions" onclick="event.stopPropagation()">
                                <button class="note-action-btn view-btn" onclick="viewNote('${note.id}')" title="Notu GÃ¶rÃ¼ntÃ¼le">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="note-action-btn edit-btn" onclick="openNoteEditModal('${note.id}')" title="Notu DÃ¼zenle">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="note-action-btn delete-btn" onclick="deleteNote('${note.id}')" title="Notu Sil">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function backToCategories() {
            currentSelectedSubject = null;
            isShowingSubjectNotes = false;
            displaySubjectCategories();
        }

        // Update the main displaySavedNotes function
        function displaySavedNotes() {
            if (!isShowingSubjectNotes) {
                displaySubjectCategories();
            } else if (currentSelectedSubject) {
                showSubjectNotes(currentSelectedSubject);
            }
        }

        // Search functionality update
        function searchNotes() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            
            if (searchTerm.trim() === '') {
                filteredNotes = savedNotes;
                displaySavedNotes();
                return;
            }

            // Switch to showing all matching notes when searching
            isShowingSubjectNotes = false;
            currentSelectedSubject = null;
            
            filteredNotes = savedNotes.filter(note => 
                note.title.toLowerCase().includes(searchTerm) ||
                note.content.toLowerCase().includes(searchTerm) ||
                getSubjectInfo(note.subject || 'diger').name.toLowerCase().includes(searchTerm)
            );

            const notesList = document.getElementById('notes-list');
            
            if (filteredNotes.length === 0) {
                notesList.innerHTML = `
                    <div class="search-results-header">
                        <button class="back-to-categories-btn" onclick="clearSearch()">
                            <i class="fas fa-times"></i> AramayÄ± Temizle
                        </button>
                        <h3><i class="fas fa-search"></i> Arama SonuÃ§larÄ±</h3>
                    </div>
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h4>"${searchTerm}" iÃ§in sonuÃ§ bulunamadÄ±</h4>
                        <p>FarklÄ± anahtar kelimeler deneyin</p>
                    </div>
                `;
                return;
            }

            notesList.innerHTML = `
                <div class="search-results-header">
                    <button class="back-to-categories-btn" onclick="clearSearch()">
                        <i class="fas fa-times"></i> AramayÄ± Temizle
                    </button>
                    <h3><i class="fas fa-search"></i> Arama SonuÃ§larÄ± (${filteredNotes.length})</h3>
                </div>
                <div class="search-results-list">
                    ${filteredNotes.map(note => {
                        const subjectInfo = getSubjectInfo(note.subject || 'diger');
                        return `
                            <div class="search-result-item subject-${note.subject || 'diger'}" onclick="openNoteEditModal('${note.id}')">
                                <div class="search-result-content">
                                    <div class="note-header-with-subject">
                                        <span class="subject-icon ${note.subject || 'diger'}">${subjectInfo.icon}</span>
                                        <h4 class="note-title">${note.title}</h4>
                                    </div>
                                    <p class="note-preview">${note.preview}</p>
                                    <div class="note-meta">
                                        <span class="note-date">
                                            <i class="fas fa-calendar"></i>
                                            ${new Date(note.createdAt).toLocaleDateString('tr-TR')}
                                        </span>
                                        <span class="note-subject">
                                            <i class="fas fa-tag"></i>
                                            ${subjectInfo.name}
                                        </span>
                                    </div>
                                </div>
                                <div class="note-actions" onclick="event.stopPropagation()">
                                    <button class="note-action-btn view-btn" onclick="viewNote('${note.id}')" title="Notu GÃ¶rÃ¼ntÃ¼le">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="note-action-btn edit-btn" onclick="openNoteEditModal('${note.id}')" title="Notu DÃ¼zenle">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="note-action-btn delete-btn" onclick="deleteNote('${note.id}')" title="Notu Sil">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function clearSearch() {
            document.getElementById('search-input').value = '';
            filteredNotes = savedNotes;
            isShowingSubjectNotes = false;
            currentSelectedSubject = null;
            displaySavedNotes();
        }
    </script>

</body>
</html>